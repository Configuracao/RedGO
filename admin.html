<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración</title>
    <style>
        body { font-family: sans-serif; background: #222; color: #eee; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        h1, h2 { color: #ff0000; border-bottom: 2px solid #555; padding-bottom: 10px; }
        .section { background: #333; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        ul { list-style: none; padding: 0; }
        li { background: #444; padding: 10px; border-radius: 5px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
        li .info { flex-grow: 1; margin-right: 15px; }
        li img { width: 40px; height: 40px; object-fit: contain; margin-right: 10px; background: white; border-radius: 4px; }
        .actions button { margin-left: 5px; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-edit { background: #ffc107; color: black; }
        .btn-delete { background: #dc3545; color: white; }
        form { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        input, select, textarea { padding: 10px; border-radius: 5px; border: 1px solid #555; background: #2a2a2a; color: #eee; }
        .form-title { font-weight: bold; font-size: 1.2em; margin-top: 20px; }
        .btn-save-form { background: #28a745; color: white; padding: 12px; font-size: 1em; cursor: pointer; }
        .btn-save-json { background: #ff0000; color: white; padding: 15px; font-size: 1.2em; cursor: pointer; width: 100%; border: none; border-radius: 8px; margin-top: 20px; }
        .warning { background: #ffc107; color: #333; padding: 15px; border-radius: 8px; margin-top: 20px; text-align: center; font-weight: bold;}
    </style>
</head>
<body>
    <div class="container">
        <h1>Panel de Administración</h1>

        <!-- SECCIÓN DE CANALES -->
        <div class="section">
            <h2>Gestión de Canales</h2>
            <ul id="channel-list-admin"></ul>
            <form id="channel-form">
                <h3 class="form-title">Añadir / Editar Canal</h3>
                <input type="hidden" id="channel-id">
                <input type="text" id="channel-name" placeholder="Nombre del Canal" required>
                <input type="url" id="channel-logo" placeholder="URL del Logo" required>
                <input type="url" id="channel-stream" placeholder="URL del Stream (embed)" required>
                <input type="text" id="channel-category" placeholder="Categoría (Ej: Deportes)" required>
                <button type="submit" class="btn-save-form">Guardar Canal</button>
            </form>
        </div>

        <!-- SECCIÓN DE NOTIFICACIONES -->
        <div class="section">
            <h2>Gestión de Notificaciones</h2>
            <ul id="notification-list-admin"></ul>
            <form id="notification-form">
                <h3 class="form-title">Enviar Nueva Notificación</h3>
                <input type="text" id="notification-title" placeholder="Título de la Notificación" required>
                <textarea id="notification-message" placeholder="Mensaje de la notificación" required></textarea>
                <select id="notification-icon" required>
                    <option value="info">Info (Azul)</option>
                    <option value="success">Success (Verde)</option>
                    <option value="warning">Warning (Amarillo)</option>
                </select>
                <button type="submit" class="btn-save-form">Añadir Notificación</button>
            </form>
        </div>
        
        <div class="warning">
            ¡IMPORTANTE! Después de guardar, se descargará un archivo `data.json`. Debes subirlo y reemplazar el antiguo en tu servidor.
        </div>
        <button id="save-json-btn" class="btn-save-json">Guardar Cambios en data.json</button>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const password = "admin"; // Cambia esta contraseña
        const userPass = prompt("Introduce la contraseña para acceder al panel:");

        if (userPass !== password) {
            alert("Contraseña incorrecta. Acceso denegado.");
            document.body.innerHTML = '<h1>Acceso Denegado</h1>';
            return;
        }

        let appData = { channels: [], notifications: [] };

        const channelListAdmin = document.getElementById('channel-list-admin');
        const channelForm = document.getElementById('channel-form');
        const notificationListAdmin = document.getElementById('notification-list-admin');
        const notificationForm = document.getElementById('notification-form');
        const saveJsonBtn = document.getElementById('save-json-btn');

        // --- CARGAR DATOS ---
        async function loadData() {
            try {
                const response = await fetch('data.json?v=' + new Date().getTime());
                appData = await response.json();
                renderAdmin();
            } catch (e) {
                console.error("No se pudo cargar data.json. Creando uno nuevo.", e);
                renderAdmin();
            }
        }

        // --- RENDERIZAR TODO EL PANEL ---
        function renderAdmin() {
            renderChannelsAdmin();
            renderNotificationsAdmin();
        }

        // --- RENDERIZAR LISTA DE CANALES ---
        function renderChannelsAdmin() {
            channelListAdmin.innerHTML = '';
            appData.channels.forEach(channel => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <div class="info">
                        <img src="${channel.logo}" alt="">
                        <strong>${channel.name}</strong> (${channel.category})
                    </div>
                    <div class="actions">
                        <button class="btn-edit" data-id="${channel.id}">Editar</button>
                        <button class="btn-delete" data-id="${channel.id}">Eliminar</button>
                    </div>
                `;
                channelListAdmin.appendChild(li);
            });
        }
        
        // --- RENDERIZAR LISTA DE NOTIFICACIONES ---
        function renderNotificationsAdmin() {
            notificationListAdmin.innerHTML = '';
            appData.notifications.forEach(notif => {
                 const li = document.createElement('li');
                 li.innerHTML = `
                    <div class="info">
                        <strong>${notif.title}</strong>: ${notif.message}
                    </div>
                    <div class="actions">
                        <button class="btn-delete-notif" data-id="${notif.id}">Eliminar</button>
                    </div>
                 `;
                 notificationListAdmin.appendChild(li);
            });
        }

        // --- GESTIÓN DE EVENTOS DE CANALES ---
        channelForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = document.getElementById('channel-id').value;
            const newChannel = {
                id: id || 'ch_' + Date.now(),
                name: document.getElementById('channel-name').value,
                logo: document.getElementById('channel-logo').value,
                streamUrl: document.getElementById('channel-stream').value,
                category: document.getElementById('channel-category').value,
            };

            if (id) { // Editando
                const index = appData.channels.findIndex(c => c.id === id);
                appData.channels[index] = newChannel;
            } else { // Añadiendo
                appData.channels.push(newChannel);
            }
            channelForm.reset();
            document.getElementById('channel-id').value = '';
            renderChannelsAdmin();
        });

        channelListAdmin.addEventListener('click', (e) => {
            if (e.target.classList.contains('btn-delete')) {
                const id = e.target.dataset.id;
                if (confirm('¿Seguro que quieres eliminar este canal?')) {
                    appData.channels = appData.channels.filter(c => c.id !== id);
                    renderChannelsAdmin();
                }
            }
            if (e.target.classList.contains('btn-edit')) {
                const id = e.target.dataset.id;
                const channel = appData.channels.find(c => c.id === id);
                document.getElementById('channel-id').value = channel.id;
                document.getElementById('channel-name').value = channel.name;
                document.getElementById('channel-logo').value = channel.logo;
                document.getElementById('channel-stream').value = channel.streamUrl;
                document.getElementById('channel-category').value = channel.category;
                window.scrollTo(0, 0);
            }
        });
        
        // --- GESTIÓN DE EVENTOS DE NOTIFICACIONES ---
        notificationForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const newNotification = {
                id: Date.now(),
                title: document.getElementById('notification-title').value,
                message: document.getElementById('notification-message').value,
                icon: document.getElementById('notification-icon').value,
                timestamp: new Date().toISOString()
            };
            appData.notifications.unshift(newNotification); // Añadir al principio
            notificationForm.reset();
            renderNotificationsAdmin();
        });

        notificationListAdmin.addEventListener('click', (e) => {
            if (e.target.classList.contains('btn-delete-notif')) {
                const id = parseInt(e.target.dataset.id, 10);
                if (confirm('¿Seguro que quieres eliminar esta notificación?')) {
                    appData.notifications = appData.notifications.filter(n => n.id !== id);
                    renderNotificationsAdmin();
                }
            }
        });

        // --- GUARDAR JSON ---
        saveJsonBtn.addEventListener('click', () => {
            const dataStr = JSON.stringify(appData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'data.json';
            a.click();
            URL.revokeObjectURL(url);
            alert('El archivo data.json se ha generado. Súbelo a tu servidor para aplicar los cambios.');
        });

        loadData();
    });
    </script>
</body>
</html>